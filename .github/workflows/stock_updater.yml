# .github/workflows/stock_updater.yml

name: Update Stock Data

# ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’å®šç¾©
on:
  # 1. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œ
  schedule:
    # cronå½¢å¼ã§æŒ‡å®š:ã€Œæ¯æ—¥ã€æ—¥æœ¬æ™‚é–“ã®18æ™‚0åˆ†ã«å®Ÿè¡Œã€
    # (UTCã§ã¯åˆå‰9æ™‚ã€‚æ—¥æœ¬ã®å¸‚å ´ãŒé–‰ã¾ã£ãŸå¾Œ)
    - cron: '30 7 * * 1-5' # æœˆæ›œæ—¥ã‹ã‚‰é‡‘æ›œæ—¥ã¾ã§
  
  # 2. æ‰‹å‹•å®Ÿè¡Œ
  # Actionsã‚¿ãƒ–ã‹ã‚‰æ‰‹å‹•ã§å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
  workflow_dispatch:

jobs:
  update-data:
    runs-on: ubuntu-latest # å®Ÿè¡Œç’°å¢ƒã¨ã—ã¦Ubuntuã®æœ€æ–°ç‰ˆã‚’ä½¿ç”¨

    steps:
      # ã‚¹ãƒ†ãƒƒãƒ—1: ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆï¼ˆã‚³ãƒ”ãƒ¼ï¼‰ã™ã‚‹
      - name: Checkout repository
        uses: actions/checkout@v4

      # ã‚¹ãƒ†ãƒƒãƒ—2: Pythonç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' # ä½¿ç”¨ã™ã‚‹Pythonã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³

      # ã‚¹ãƒ†ãƒƒãƒ—3: å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
      - name: Install dependencies
        run: pip install -r requirements.txt

      # ã‚¹ãƒ†ãƒƒãƒ—4: Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹
      - name: Run script to update data
        run: python main.py

      # ã‚¹ãƒ†ãƒƒãƒ—5: å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆCSVï¼‰ã‚’è‡ªå‹•ã§ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹
      - name: Commit and push if there are changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ“ˆ è‡ªå‹•æ›´æ–°: æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ"
          file_pattern: "*.csv" # CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚’ã‚³ãƒŸãƒƒãƒˆã®å¯¾è±¡ã«ã™ã‚‹
          commit_user_name: "GitHub Actions Bot"
          commit_user_email: "actions@github.com"
          commit_author: "GitHub Actions Bot <actions@github.com>"
